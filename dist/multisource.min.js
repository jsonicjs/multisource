!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JsonicMultiSource=e()}}((function(){var define,module,exports,createModuleFactory=function(e){var t;return function(n){return t||e(t={exports:{},parent:n},t.exports),t.exports}},_$multisource_1=createModuleFactory((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TOP=t.NONE=t.resolvePathSpec=t.MultiSource=void 0;const n=_$jsonic_3({});t.NONE="";const o=Symbol("TOP");t.TOP=o;const l=(e,t)=>{const n=t.markchar,o=t.resolver,l=t.processor,{deep:r}=e.util,i=t.implictExt||[];for(let u=0;u<i.length;u++){let e=i[u];i[u]=e.startsWith(".")?e:"."+e}e.options({error:{multisource_not_found:"source not found: $path"},hint:{multisource_not_found:"The source path $path was not found."}});let s={name:"multisource",open:n,rules:{open:"val,pair"},action:function(n,i){var s;let u=n.parent.name,a=n.child.node,c=o(a,t,n,i,e);if(!c.found)return null===(s=n.parent)||void 0===s?void 0:s.o0.bad("multisource_not_found",{...c});c.kind=null==c.kind?"":c.kind,(l[c.kind]||l[""])(c,t,n,i,e),"pair"===u?i.cfg.map.merge?n.parent.parent.node=i.cfg.map.merge(n.parent.parent.node,c.val,n,i):i.cfg.map.extend?n.parent.parent.node=r(n.parent.parent.node,c.val):Object.assign(n.parent.node,c.val):n.node=c.val},custom:(e,{OPEN:t,name:n})=>{e.rule("val",e=>{e.open({s:[t],c:e=>0===e.d,p:"map",b:1,n:{[n+"_top"]:1}})}),e.rule("map",e=>{e.open({s:[t],c:e=>1===e.d&&1===e.n[n+"_top"],p:"pair",b:1})})}};e.use(_$directiveMin_4.Directive,s)};function r(e){return t=>t.val=e(t.src,t)}t.MultiSource=l;const i=r(e=>e),s=r(e=>null==e?void 0:JSON.parse(e)),u=(0,n.makeJsonicProcessor)(),a=(0,_$js_2.makeJavaScriptProcessor)();l.defaults={markchar:"@",processor:{"":i,jsonic:u,jsc:u,json:s,js:a},implictExt:["jsonic","jsc","json","js"]},t.resolvePathSpec=function(e,t,n,o){var l;let r=null===(l=t.meta)||void 0===l?void 0:l.multisource,i=o(null==r||null==r.path?e.path:r.path),s="string"==typeof n?n:null!=n.path?""+n.path:void 0,u=!(!(null==s?void 0:s.startsWith("/"))&&!(null==s?void 0:s.startsWith("\\"))),a=u?s:null!=s&&""!=s?null!=i&&""!=i?i+"/"+s:s:void 0;return{kind:null==a?"":(a.match(/\.([^.]*)$/)||["",""])[1],path:s,full:a,base:i,abs:u,found:!1}}})),_$jsonic_3=createModuleFactory((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeJsonicProcessor=void 0;const n=_$multisource_1({});t.makeJsonicProcessor=function(){return function(e,t,o,l,r){var i;if(null!=e.src&&null!=e.full){let t=(null===(i=l.meta)||void 0===i?void 0:i.multisource)||{},o={...l.meta||{},multisource:{...t,path:e.full}};if(e.val=r(e.src,o),t.deps){let o=t.deps,l=t.path||n.TOP;if(null!=l){let t={tar:l,src:e.full,wen:Date.now()};o[l]=o[l]||{},o[l][e.full]=t}}}}}})),_$directiveMin_4={exports:{}};(function(e){(function(){!function(t){"object"==typeof _$directiveMin_4.exports?_$directiveMin_4.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).JsonicDirective=t()}((function(){var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.Directive=void 0;const t=e=>("string"==typeof e?e.split(/\s*,\s*/):e||[]).filter(e=>null!=e&&""!==e),n=(e,n)=>{var o,l;let r,i={open:t(null===(o=null==n?void 0:n.rules)||void 0===o?void 0:o.open),close:t(null===(l=null==n?void 0:n.rules)||void 0===l?void 0:l.close)},s=n.name,u=n.open,a=n.close,c=n.custom;if("string"==typeof n.action){let t=n.action;r=n=>n.node=e.util.prop(e.options,t)}else r=n.action;let d={},p="#OD_"+s,f="#CD_"+s,v=e.fixed(u),_=null==a?null:e.fixed(a);if(null!=v)throw new Error("Directive open token already in use: "+u);d[p]=u,null==_&&null!=a&&(d[f]=a),e.options({fixed:{token:d},error:{[s+"_close"]:null==a?null:"directive "+s+' close "'+a+'" without open "'+u+'"'},hint:{[s+"_close"]:null==a?null:`\nThe ${s} directive must start with the characters "${u}" and end\nwith the characters "${a}". The end characters "${a}" may not\nappear without the start characters "${u}" appearing first:\n"${u}...${a}".\n`}});let m=e.token.CA;v=e.fixed(u),_=null==a?null:e.fixed(a),i.open.forEach(t=>{e.rule(t,e=>(e.open({s:[v],p:s,n:{["dr_"+s]:1},g:"start"}),null!=a&&(e.open({s:[v,_],b:1,p:s,n:{["dr_"+s]:1},g:"start,end"}),e.close({s:[_],b:1,g:"end"})),e))}),null!=a&&i.close.forEach(t=>{e.rule(t,e=>{e.close([{s:[_],c:e=>1===e.n["dr_"+s],b:1,g:"end"},{s:[m,_],c:e=>1===e.n["dr_"+s],b:1,g:"end,comma"}])})}),e.rule(s,e=>e.clear().bo(e=>{e.node={}}).open([null!=a?{s:[_],b:1}:null,{p:"val",n:null==a?{dlist:1,dmap:1}:{dlist:0,dmap:0}}]).bc((function(e,t,n,o){let l=r.call(this,e,t,n,o);if(null==l?void 0:l.isToken)return l})).close(null!=a?[{s:[_]},{s:[m,_]}]:[])),c&&c(e,{OPEN:v,CLOSE:_,name:s})};return e.Directive=n,n.defaults={rules:{open:"val",close:"list,elem,map,pair"}},e}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),_$directiveMin_4=_$directiveMin_4.exports;var _$js_2={};function makeJavaScriptProcessor(e){const t=t=>{t.val=evaluate(t,e)};return t.opts=e,t}function evaluate(res,opts){let out;if(!0!==(null==opts?void 0:opts.evalOnly))out=require(res.full);else{let exports=null,module={exports:exports};eval(res.src),out=module.exports}return out}return Object.defineProperty(_$js_2,"__esModule",{value:!0}),_$js_2.makeJavaScriptProcessor=void 0,_$js_2.makeJavaScriptProcessor=makeJavaScriptProcessor,_$multisource_1(),_$multisource_1}));
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JsonicMultiSource=e()}}((function(){var define,module,exports,createModuleFactory=function(e){var n;return function(t){return n||e(n={exports:{},parent:t},n.exports),n.exports}},_$multisource_1=createModuleFactory((function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TOP=n.NONE=n.resolvePathSpec=n.MultiSource=void 0;const t=_$jsonic_3({});n.NONE="";const o=Symbol("TOP");n.TOP=o;const l=(e,n)=>{const t=n.markchar,o=n.resolver,l=n.processor,{deep:r}=e.util,i=n.implictExt||[];for(let u=0;u<i.length;u++){let e=i[u];i[u]=e.startsWith(".")?e:"."+e}e.options({error:{multisource_not_found:"source not found: $path"},hint:{multisource_not_found:"The source path $path was not found.\n\nSearch paths:\n${searchstr}"}});let s={name:"multisource",open:t,rules:{open:"val,pair"},action:function(t,i){var s;let u=t.parent.name,a=t.child.node,c=o(a,n,t,i,e);if(!c.found)return null===(s=t.parent)||void 0===s?void 0:s.o0.bad("multisource_not_found",{...c,searchstr:((null==c?void 0:c.search)||[c.full]).join("\n")});c.kind=null==c.kind?"":c.kind,(l[c.kind]||l[""])(c,n,t,i,e),"pair"===u?i.cfg.map.merge?t.parent.parent.node=i.cfg.map.merge(t.parent.parent.node,c.val,t,i):i.cfg.map.extend?t.parent.parent.node=r(t.parent.parent.node,c.val):Object.assign(t.parent.node,c.val):t.node=c.val},custom:(e,{OPEN:n,name:t})=>{e.rule("val",e=>{e.open({s:[n],c:e=>0===e.d,p:"map",b:1,n:{[t+"_top"]:1}})}),e.rule("map",e=>{e.open({s:[n],c:e=>1===e.d&&1===e.n[t+"_top"],p:"pair",b:1})})}};e.use(_$directiveMin_4.Directive,s)};function r(e){return n=>n.val=e(n.src,n)}n.MultiSource=l;const i=r(e=>e),s=r(e=>null==e?void 0:JSON.parse(e)),u=(0,t.makeJsonicProcessor)(),a=(0,_$js_2.makeJavaScriptProcessor)();l.defaults={markchar:"@",processor:{"":i,jsonic:u,jsc:u,json:s,js:a},implictExt:["jsonic","jsc","json","js"]},n.resolvePathSpec=function(e,n,t,o){var l;let r=null===(l=n.meta)||void 0===l?void 0:l.multisource,i=o(null==r||null==r.path?e.path:r.path),s="string"==typeof t?t:null!=t.path?""+t.path:void 0,u=!(!(null==s?void 0:s.startsWith("/"))&&!(null==s?void 0:s.startsWith("\\"))),a=u?s:null!=s&&""!=s?null!=i&&""!=i?i+"/"+s:s:void 0;return{kind:null==a?"":(a.match(/\.([^.]*)$/)||["",""])[1],path:s,full:a,base:i,abs:u,found:!1}}})),_$jsonic_3=createModuleFactory((function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.makeJsonicProcessor=void 0;const t=_$multisource_1({});n.makeJsonicProcessor=function(){return function(e,n,o,l,r){var i;if(null!=e.src&&null!=e.full){let n=(null===(i=l.meta)||void 0===i?void 0:i.multisource)||{},o={...l.meta||{},multisource:{...n,path:e.full}};if(e.val=r(e.src,o),n.deps){let o=n.deps,l=n.path||t.TOP;if(null!=l){let n={tar:l,src:e.full,wen:Date.now()};o[l]=o[l]||{},o[l][e.full]=n}}}}}})),_$directiveMin_4={exports:{}};(function(e){(function(){!function(n){"object"==typeof _$directiveMin_4.exports?_$directiveMin_4.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).JsonicDirective=n()}((function(){var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.Directive=void 0;const n=e=>("string"==typeof e?e.split(/\s*,\s*/):e||[]).filter(e=>null!=e&&""!==e),t=(e,t)=>{var o,l;let r,i={open:n(null===(o=null==t?void 0:t.rules)||void 0===o?void 0:o.open),close:n(null===(l=null==t?void 0:t.rules)||void 0===l?void 0:l.close)},s=t.name,u=t.open,a=t.close,c=t.custom;if("string"==typeof t.action){let n=t.action;r=t=>t.node=e.util.prop(e.options,n)}else r=t.action;let d={},p="#OD_"+s,f="#CD_"+s,v=e.fixed(u),_=null==a?null:e.fixed(a);if(null!=v)throw new Error("Directive open token already in use: "+u);d[p]=u,null==_&&null!=a&&(d[f]=a),e.options({fixed:{token:d},error:{[s+"_close"]:null==a?null:"directive "+s+' close "'+a+'" without open "'+u+'"'},hint:{[s+"_close"]:null==a?null:`\nThe ${s} directive must start with the characters "${u}" and end\nwith the characters "${a}". The end characters "${a}" may not\nappear without the start characters "${u}" appearing first:\n"${u}...${a}".\n`}});let m=e.token.CA;v=e.fixed(u),_=null==a?null:e.fixed(a),i.open.forEach(n=>{e.rule(n,e=>(e.open({s:[v],p:s,n:{["dr_"+s]:1},g:"start"}),null!=a&&(e.open({s:[v,_],b:1,p:s,n:{["dr_"+s]:1},g:"start,end"}),e.close({s:[_],b:1,g:"end"})),e))}),null!=a&&i.close.forEach(n=>{e.rule(n,e=>{e.close([{s:[_],c:e=>1===e.n["dr_"+s],b:1,g:"end"},{s:[m,_],c:e=>1===e.n["dr_"+s],b:1,g:"end,comma"}])})}),e.rule(s,e=>e.clear().bo(e=>{e.node={}}).open([null!=a?{s:[_],b:1}:null,{p:"val",n:null==a?{dlist:1,dmap:1}:{dlist:0,dmap:0}}]).bc((function(e,n,t,o){let l=r.call(this,e,n,t,o);if(null==l?void 0:l.isToken)return l})).close(null!=a?[{s:[_]},{s:[m,_]}]:[])),c&&c(e,{OPEN:v,CLOSE:_,name:s})};return e.Directive=t,t.defaults={rules:{open:"val",close:"list,elem,map,pair"}},e}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),_$directiveMin_4=_$directiveMin_4.exports;var _$js_2={};function makeJavaScriptProcessor(e){const n=n=>{n.val=evaluate(n,e)};return n.opts=e,n}function evaluate(res,opts){let out;if(!0!==(null==opts?void 0:opts.evalOnly))out=require(res.full);else{let exports=null,module={exports:exports};eval(res.src),out=module.exports}return out}return Object.defineProperty(_$js_2,"__esModule",{value:!0}),_$js_2.makeJavaScriptProcessor=void 0,_$js_2.makeJavaScriptProcessor=makeJavaScriptProcessor,_$multisource_1(),_$multisource_1}));